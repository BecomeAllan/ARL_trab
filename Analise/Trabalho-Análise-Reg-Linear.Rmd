---
title: 
output: 
   pdf_document :
      latex_engine : xelatex
fontsize: 10pt
---
\centering
\raggedright
\begin{center}
```{r pressure, echo=FALSE,out.width = '25%',fig.align='center'}
knitr::include_graphics("unb.png")
```
 {\Large Análise de Regressão Linear}\\
 {\bfseries Nome:} Ananda Almeida de Sá\\
 {\bfseries Matrícula:} 150117345\\
 {\bfseries Data:} 04/05/2022
 \end{center} 
 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introdução 

## Leitura de dados

\ \ O programa utilizado para analisar os dados disponibilizados em Excel será o R Studio, versão 4.2.0, importados como um data frame (planilha), onde as colunas representam as variáveis de estudo e cada linha representa um hospital dos Estados Unidos no período de 1975-1976.

```{r, include=FALSE}
library(readxl)
datax <- read_excel('Dados_trabalho_20212.xlsx')
datax <- na.omit(datax)
datax$X7 <- as.factor(datax$X7)
datax$X8 <- as.factor(datax$X8)
datax$ID <- as.factor(datax$ID)

data<-datax


names(data) <- c('Número de Identificação', 'Duração da Internação', 'Idade', 'Risco de Infecção', 'Proporção de Culturas de Rotina', 'Proporção de Raio-X de Tórax de Rotina', 'Número de leitos', 'Filiação a Escola de Medicina', 'Região', 'Média diária de pacientes', 'Número de enfermeiro(s)', 'Facilidades e serviços disponíveis')
data
```
## Análise Exploratória

### Estatísticas Descritivas

\ \ Uma maneira fácil de obter algumas estatísticas descritivas das variáveis em estudo é através do comando *summary()*, que retorna as estatísticas *mínimo*, *quartis*, *média* e *máximo*. Para medir a variabilidade, utilize as funções *var()* e *sd()* para obter a *variância* e o *desvio padrão* outra forma de avaliar essas estatísticas é através do gráfico *boxplot*. Aplicando para cada variável, tem-se

* **Duração da Internação**

\ \ A duração de internação é uma variável quantitativa contínua que representa a duração média da internação de todos os pacientes no hospital (em dias). Os resultados das funções mencionadas anteriormente estão descritos a seguir. 

```{r, echo=FALSE}
summary <- data.frame(unclass(summary(data$`Duração da Internação`)), check.names = FALSE, stringsAsFactors = FALSE)
summary['Variância',] <- var(data$`Duração da Internação`)
summary['Desvio Padrão',] <- sd(data$`Duração da Internação`)
names(summary) <- c('Duração da Internação')
rownames(summary) <- c('Mínimo', '1º Quartil', 'Mediana', 'Média', '3º Quartil', 'Máximo', 'Variância', 'Desvio Padrão')

knitr::kable(summary)
```

\ \ E o *boxplot* da variável é dado por:
```{r}

boxplot(data$`Duração da Internação`)
```

* **Idade**

\ \ A idade é uma variável quantitativa contínua que representa a idade média dos pacientes de cada hospital. Os resultados das funções mencionadas anteriormente estão descritos a seguir. 

```{r, echo=FALSE}
summary <- data.frame(unclass(summary(data$Idade)), check.names = FALSE, stringsAsFactors = FALSE)
summary['Variância',] <- var(data$Idade)
summary['Desvio Padrão',] <- sd(data$Idade)
names(summary) <- c('Idade')
rownames(summary) <- c('Mínimo', '1º Quartil', 'Mediana', 'Média', '3º Quartil', 'Máximo', 'Variância', 'Desvio Padrão')

knitr::kable(summary)
```

\ \ E o *boxplot* da variável é dado por:
```{r}

boxplot(data$Idade)
```

* **Risco de Infecção**

\ \ O risco de infecção é uma variável quantitativa contínua que representa a probabilidade média estimada de adquirir infecção no hospital (em %). Os resultados das funções mencionadas anteriormente estão descritos a seguir. 

```{r, echo=FALSE}
summary <- data.frame(unclass(summary(data$`Risco de Infecção`)), check.names = FALSE, stringsAsFactors = FALSE)
summary['Variância',] <- var(data$`Risco de Infecção`)
summary['Desvio Padrão',] <- sd(data$`Risco de Infecção`)
names(summary) <- c('Risco de Infecção')
rownames(summary) <- c('Mínimo', '1º Quartil', 'Mediana', 'Média', '3º Quartil', 'Máximo', 'Variância', 'Desvio Padrão')

knitr::kable(summary)
```

\ \ E o *boxplot* da variável é dado por:
```{r}
boxplot(data$`Risco de Infecção`)
```

* **Proporção de Culturas de Rotina**

\ \ A proporção de culturas de rotina é uma variável quantitativa contínua que representa a razão do número de culturas realizadas com relação ao número de pacientes sem sinais ou sintomas de infeção adquirida no hospital, vezes 100. Os resultados das funções mencionadas anteriormente estão descritos a seguir. 

```{r, echo=FALSE}
summary <- data.frame(unclass(summary(data$`Proporção de Culturas de Rotina`)), check.names = FALSE, stringsAsFactors = FALSE)
summary['Variância',] <- var(data$`Proporção de Culturas de Rotina`)
summary['Desvio Padrão',] <- sd(data$`Proporção de Culturas de Rotina`)
names(summary) <- c('Proporção de Culturas de Rotina')
rownames(summary) <- c('Mínimo', '1º Quartil', 'Mediana', 'Média', '3º Quartil', 'Máximo', 'Variância', 'Desvio Padrão')

knitr::kable(summary)
```

\ \ E o *boxplot* da variável é dado por:
```{r}
boxplot(data$`Proporção de Culturas de Rotina`)
```
* **Proporção de Raio-X de Tórax de Rotina**

\ \ A proporção de raio-X de tórax de rotina é uma variável quantitativa contínua que representa a razão do número de raio-X de tórax realizados com relação ao número de pacientes sem sinais ou sintomas de pneumonia, vezes 100. Os resultados das funções mencionadas anteriormente estão descritos a seguir. 

```{r, echo=FALSE}
summary <- data.frame(unclass(summary(data$`Proporção de Raio-X de Tórax de Rotina`)), check.names = FALSE, stringsAsFactors = FALSE)
summary['Variância',] <- var(data$`Proporção de Raio-X de Tórax de Rotina`)
summary['Desvio Padrão',] <- sd(data$`Proporção de Raio-X de Tórax de Rotina`)
names(summary) <- c('Proporção de Raio-X de Tórax de Rotina')
rownames(summary) <- c('Mínimo', '1º Quartil', 'Mediana', 'Média', '3º Quartil', 'Máximo', 'Variância', 'Desvio Padrão')

knitr::kable(summary)
```

\ \ E o *boxplot* da variável é dado por:
```{r}
boxplot(data$`Proporção de Raio-X de Tórax de Rotina`)
```

* **Número de leitos**

\ \ O número de leitos é uma variável quantitativa discreta que representa o número médio de leitos no hospital durante o período de estudo. Os resultados das funções mencionadas anteriormente estão descritos a seguir. 

```{r, echo=FALSE}
summary <- data.frame(unclass(summary(data$`Número de leitos`)), check.names = FALSE, stringsAsFactors = FALSE)
summary['Variância',] <- var(data$`Número de leitos`)
summary['Desvio Padrão',] <- sd(data$`Número de leitos`)
names(summary) <- c('Número de leitos')
rownames(summary) <- c('Mínimo', '1º Quartil', 'Mediana', 'Média', '3º Quartil', 'Máximo', 'Variância', 'Desvio Padrão')

knitr::kable(summary)
```

\ \ E o *boxplot* da variável é dado por:
```{r}
boxplot(data$`Número de leitos`)
```

* **Filiação a Escola de Medicina**

\ \ A filiação a escola de medicina é uma variável qualitativa ordinal onde o 1 significa que a escola tem filiação, e 2 que não tem. Os resultados das funções mencionadas anteriormente estão descritos a seguir. 

```{r, echo=FALSE}
filiacao <- table(data$`Filiação a Escola de Medicina`)
par(mfrow = c(1, 2))
barplot(filiacao, ylab = "Frequência absoluta")
barplot(prop.table(filiacao), ylab = "Frequência relativa",
        ylim = c(0, .6))
par(mfrow = c(1,1))

```

* **Região**

\ \ A região é uma variáveis qualitativas ordinais onde "NE" se refere ao Nordeste, "W" ao Oeste, "S" ao Sul e "NC" ao ?????. Os resultados das funções mencionadas anteriormente estão descritos a seguir. 

```{r, echo=FALSE}
filiacao <- table(data$Região)
par(mfrow = c(1, 2))
barplot(filiacao, ylab = "Frequência absoluta")
barplot(prop.table(filiacao), ylab = "Frequência relativa",
        ylim = c(0, .6))
par(mfrow = c(1,1))

```

* **Média diária de pacientes**

\ \ O média diária de pacientes é uma variável quantitativa discreta que representa o número médio de pacientes no hospital por dia durante o período do estudo. Os resultados das funções mencionadas anteriormente estão descritos a seguir. 

```{r, echo=FALSE}
summary <- data.frame(unclass(summary(data$`Média diária de pacientes`)), check.names = FALSE, stringsAsFactors = FALSE)
summary['Variância',] <- var(data$`Média diária de pacientes`)
summary['Desvio Padrão',] <- sd(data$`Média diária de pacientes`)
names(summary) <- c('Média diária de pacientes')
rownames(summary) <- c('Mínimo', '1º Quartil', 'Mediana', 'Média', '3º Quartil', 'Máximo', 'Variância', 'Desvio Padrão')

knitr::kable(summary)
```

\ \ E o *boxplot* da variável é dado por:
```{r}
boxplot(data$`Média diária de pacientes`)
```

* **Número de enfermeiro(s)**

\ \ O número de enfermeiro(s) é uma variável quantitativa discreta que representa o Número médio de enfermeiros(as) de tempo-integral ou equivalente registrados e licenciados durante o período de estudo (número de tempos integrais+metade do número de tempo parcial). Os resultados das funções mencionadas anteriormente estão descritos a seguir. 

```{r, echo=FALSE}
summary <- data.frame(unclass(summary(data$`Número de enfermeiro(s)`)), check.names = FALSE, stringsAsFactors = FALSE)
summary['Variância',] <- var(data$`Número de enfermeiro(s)`)
summary['Desvio Padrão',] <- sd(data$`Número de enfermeiro(s)`)
names(summary) <- c('Número de enfermeiro(s)')
rownames(summary) <- c('Mínimo', '1º Quartil', 'Mediana', 'Média', '3º Quartil', 'Máximo', 'Variância', 'Desvio Padrão')

knitr::kable(summary)
```

\ \ E o *boxplot* da variável é dado por:
```{r}
boxplot(data$`Número de enfermeiro(s)`)
```

* **Facilidades e serviços disponíveis**

\ \ A facilidades e serviços disponíveis é uma variável quantitativa contínua que representa a porcentagem de 35 potenciais facilidades e serviços que são fornecidos pelo hospital. Os resultados das funções mencionadas anteriormente estão descritos a seguir. 

```{r, echo=FALSE}
summary <- data.frame(unclass(summary(data$`Facilidades e serviços disponíveis`)), check.names = FALSE, stringsAsFactors = FALSE)
summary['Variância',] <- var(data$`Facilidades e serviços disponíveis`)
summary['Desvio Padrão',] <- sd(data$`Facilidades e serviços disponíveis`)
names(summary) <- c('Facilidades e serviços disponíveis')
rownames(summary) <- c('Mínimo', '1º Quartil', 'Mediana', 'Média', '3º Quartil', 'Máximo', 'Variância', 'Desvio Padrão')

knitr::kable(summary)
```

\ \ E o *boxplot* da variável é dado por:
```{r}
boxplot(data$`Facilidades e serviços disponíveis`)
```

### Correlação entre as variáveis 
\ \ Para verificar a natureza e a força da relação entre as variáveis e identificar lacunas e pontos discrepantes no conjunto de dados, utiliza-se a matriz de correlação aplicado no script a seguir.

```{r}
library(ggcorrplot)
library(dplyr)

pmat = datax %>% select_if(is.numeric) %>%cor_pmat()

datax %>% select_if(is.numeric) %>% cor(.) %>% 
  ggcorrplot( type = "lower", p.mat = pmat, hc.order = TRUE)
```
```{r}
knitr::kable(cbind(names(data),names(datax)))
```


nesta matriz, percebe-se que quanto mais vermelho, maior é a correlação positiva, no qual as variável de facilidades e serviços disponiveis está positivamente correlacionada com o número de enfermeiro(s), número de leitos e a média diaria de pacientes. Para o número de leitos, há uma alta correlação positiva com a média diária depacientes.

Para verificar a ausência significativa de correlação, o teste de ausência de correlação com nível de significância de 5%, no gráfico acima, temos que as variáveis que são marcadas com X, o teste não foi significante, indicando independência entre estas variáveis, entre elas, a idade do paciente, não tem correlação com o risco de infeção do hospital.


#  Objetivo 


## Número de enfermeira(o)s

\ \ Deseja-se estudar se o número de enfermeira(o)s está relacionado às instalações, ou seja, os números de leitos do hospital, e  se há diferenças entre os  serviços disponíveis pelos hospitais.  Neste caso, a variável resposta é o número de enfermeira(o)s e as duas outras variáveis são explicativas. Para isso, faz-se necessário a aplicação da regressão linear múltipla realizada no script a seguir:


```{r}
# teste de ausencia de regresao (significativo)
summary(aov(`Número de enfermeiro(s)` ~ `Número de leitos`+ `Facilidades e serviços disponíveis`, data=data))
```


```{r}
modcomp<-lm(`Número de enfermeiro(s)` ~ `Número de leitos` +
              I(`Número de leitos`^2)+
              `Facilidades e serviços disponíveis`+
              I(`Facilidades e serviços disponíveis`^2)+
              `Facilidades e serviços disponíveis`*`Número de leitos`
              , data = data)
            
summary(modcomp)
```




```{r}
shapiro.test(residuals(modcomp))



# windows()
par(mfrow = c(2, 2))
plot(fitted(modcomp), residuals(modcomp),xlab="Valores Ajustados",ylab="Resíduos")
abline(h=0)
plot(data$`Número de leitos`, residuals(modcomp),xlab="Número de leitos",ylab="Resíduos")
abline(h=0)

plot(data$`Facilidades e serviços disponíveis`, residuals(modcomp),xlab="Facilidades e serviços disponíveis",ylab="Resíduos")
abline(h=0)

qqnorm(residuals(modcomp), ylab="Resíduos",xlab="Quantis teóricos",main="")
qqline(residuals(modcomp))
```

## Número de enfermeira(o)s

```{r}
# Teste de ausencia de regressao
summary(aov(`Duração da Internação` ~
              `Proporção de Raio-X de Tórax de Rotina`+
              `Proporção de Culturas de Rotina`,
            data = data))

# Regressao
modcomp<-lm(`Duração da Internação` ~
              `Proporção de Raio-X de Tórax de Rotina`+
              `Proporção de Culturas de Rotina`,
            data = data)
summary(modcomp)
```

```{r}
# Teste de normalidade
shapiro.test(residuals(modcomp))
# bartlett.test(residuals(modcomp))



# windows()
par(mfrow = c(2, 2))
plot(fitted(modcomp), residuals(modcomp),xlab="Valores Ajustados",ylab="Resíduos")
abline(h=0)
plot(data$`Proporção de Raio-X de Tórax de Rotina`, residuals(modcomp),xlab="Proporção de Raio-X de Tórax de Rotina",ylab="Resíduos")
abline(h=0)

plot(data$`Proporção de Culturas de Rotina`, residuals(modcomp),xlab="Proporção de Culturas de Rotina",ylab="Resíduos")
abline(h=0)

qqnorm(residuals(modcomp), ylab="Resíduos",xlab="Quantis teóricos",main="")
qqline(residuals(modcomp))
```

